// src/App.jsx - WITH PDF SAFETY GUARD INTEGRATION
// Example of how to integrate the PDF Safety Guard

/*

INTEGRATION STEPS:

1. Add imports at the top:
   import { usePDFSafetyGuard } from './hooks/usePDFSafetyGuard';
   import PDFWarningModal from './components/PDFWarningModal';
   import './styles/pdfWarningModal.css';

2. Add the safety guard hook in your component:
   const safetyGuard = usePDFSafetyGuard();

3. Before loading PDF, run the preflight check:
   const result = await safetyGuard.check(file);

4. Render the warning modal:
   <PDFWarningModal ... />

EXAMPLE CODE:
*/

import React, { useState } from 'react';
import { usePDF } from './context/PDFContext';
import { usePDFSafetyGuard } from './hooks/usePDFSafetyGuard';
import PDFWarningModal from './components/PDFWarningModal';
import Toolbar from './components/Toolbar';
import Sidebar from './components/Sidebar';
import PDFViewer from './components/PDFViewer';
import './styles/pdfWarningModal.css';
import './styles/main.css';

const App = () => {
    const { loadPDF, error, isLoading } = usePDF();
    const safetyGuard = usePDFSafetyGuard();
    const [selectedFile, setSelectedFile] = useState(null);
    const [isSafeMode, setIsSafeMode] = useState(false);
    
    /**
     * Handle file selection from input or drag-drop
     */\n    const handlePDFSelected = async (file) => {\n        setSelectedFile(file);\n        \n        // Run preflight check (non-blocking)\n        const result = await safetyGuard.check(file);\n        \n        switch (result.status) {\n            case 'ALLOWED':\n                // Safe to load normally\n                await loadPDF(file);\n                safetyGuard.reset();\n                break;\n                \n            case 'BLOCKED':\n                // Show warning modal with options\n                // Modal is shown automatically by safetyGuard.showWarning\n                break;\n                \n            case 'ERROR':\n                // Show error\n                alert(`Error checking PDF: ${result.error}`);\n                safetyGuard.reset();\n                break;\n                \n            case 'CANCELLED':\n                // User cancelled\n                safetyGuard.reset();\n                break;\n        }\n    };\n    \n    /**\n     * Handle user choosing to load in Safe Mode\n     */\n    const handleLoadInSafeMode = async () => {\n        try {\n            setIsSafeMode(true);\n            // Load with safe mode enabled\n            // Pass flag to PDF loader to limit pages, reduce quality, etc.\n            await loadPDF(selectedFile, { safeMode: true });\n            safetyGuard.setShowWarning(false);\n        } catch (err) {\n            alert(`Failed to load in Safe Mode: ${err.message}`);\n        }\n    };\n    \n    /**\n     * Handle user choosing download only\n     */\n    const handleDownloadOnly = () => {\n        if (selectedFile instanceof File) {\n            // Trigger browser download\n            const url = URL.createObjectURL(selectedFile);\n            const a = document.createElement('a');\n            a.href = url;\n            a.download = selectedFile.name;\n            document.body.appendChild(a);\n            a.click();\n            document.body.removeChild(a);\n            URL.revokeObjectURL(url);\n        }\n        safetyGuard.reset();\n    };\n    \n    /**\n     * Handle user cancelling\n     */\n    const handleCancel = () => {\n        safetyGuard.reset();\n        setSelectedFile(null);\n    };\n    \n    /**\n     * Handle drag and drop\n     */\n    const handleDragOver = (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n    };\n    \n    const handleDrop = (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        \n        const files = e.dataTransfer.files;\n        if (files.length > 0) {\n            const file = files[0];\n            if (file.type === 'application/pdf') {\n                handlePDFSelected(file);\n            } else {\n                alert('Please drop a PDF file');\n            }\n        }\n    };\n    \n    /**\n     * Handle file input\n     */\n    const handleFileInput = (e) => {\n        if (e.target.files?.length > 0) {\n            handlePDFSelected(e.target.files[0]);\n        }\n    };\n    \n    return (\n        <div className=\"app-container\">\n            {/* Toolbar */}\n            <Toolbar />\n            \n            <div className=\"app-main\">\n                {/* Sidebar */}\n                <Sidebar />\n                \n                {/* Main Content */}\n                <div className=\"app-content\">\n                    {/* Check if PDF is loaded */}\n                    {!loadedPDF ? (\n                        // Upload area\n                        <div\n                            className=\"pdf-upload-area\"\n                            onDragOver={handleDragOver}\n                            onDrop={handleDrop}\n                        >\n                            <div className=\"upload-content\">\n                                <h2>üìÑ Open a PDF to start reading</h2>\n                                <p>\n                                    Drag and drop your PDF here, or click to select a file.\n                                </p>\n                                \n                                {safetyGuard.isChecking && (\n                                    <div className=\"checking-status\">\n                                        <p>‚è≥ Checking PDF: {safetyGuard.checkProgress}</p>\n                                        <progress />\n                                    </div>\n                                )}\n                                \n                                <input\n                                    type=\"file\"\n                                    accept=\".pdf\"\n                                    onChange={handleFileInput}\n                                    disabled={safetyGuard.isChecking}\n                                    id=\"pdf-input\"\n                                    style={{ display: 'none' }}\n                                />\n                                \n                                <button\n                                    onClick={() => document.getElementById('pdf-input').click()}\n                                    disabled={safetyGuard.isChecking}\n                                    className=\"btn-select-pdf\"\n                                >\n                                    {safetyGuard.isChecking ? 'üîç Analyzing...' : 'üìÅ Select PDF'}\n                                </button>\n                            </div>\n                        </div>\n                    ) : (\n                        // PDF Viewer\n                        <PDFViewer />\n                    )}\n                </div>\n            </div>\n            \n            {/* PDF Warning Modal */}\n            <PDFWarningModal\n                isOpen={safetyGuard.showWarning}\n                analysis={safetyGuard.preflightResult?.analysis}\n                riskAssessment={safetyGuard.preflightResult?.riskAssessment}\n                isLoading={safetyGuard.isChecking}\n                onAllow={async () => {\n                    // User chose to load anyway\n                    await loadPDF(selectedFile);\n                    safetyGuard.setShowWarning(false);\n                }}\n                onLoadSafeMode={handleLoadInSafeMode}\n                onDownloadOnly={handleDownloadOnly}\n                onCancel={handleCancel}\n            />\n        </div>\n    );\n};\n\nexport default App;\n\n/*\n\n=== WHAT THIS DOES ===\n\n1. User selects PDF (file input or drag-drop)\n   ‚Üì\n2. handlePDFSelected() called\n   ‚Üì\n3. Safety Guard runs preflight check (non-blocking)\n   - Checks file size\n   - Analyzes PDF structure\n   - Assesses risk\n   ‚Üì\n4. Results handled:\n   - ALLOWED: Load normally\n   - BLOCKED: Show warning modal\n   - ERROR: Show error alert\n   - CANCELLED: Reset state\n   ‚Üì\n5. If warning modal shown:\n   - User sees file details\n   - User sees risks/warnings\n   - User chooses action:\n     * Load (if safe)\n     * Load in Safe Mode\n     * Download only\n     * Cancel\n   ‚Üì\n6. Action executed, modal closed\n   ‚Üì\n7. PDF loaded (or not) based on user choice\n\n=== KEY FEATURES ===\n\n‚úÖ App NEVER freezes during check\n‚úÖ User gets clear feedback\n‚úÖ Safe defaults (blocks 50MB+ PDFs)\n‚úÖ Configurable limits\n‚úÖ Safe Mode option for large PDFs\n‚úÖ Download without rendering option\n‚úÖ Beautiful modal UI\n‚úÖ Mobile responsive\n‚úÖ Accessibility compliant\n\n=== CUSTOMIZATION ===\n\nChange default limits:\n    const safetyGuard = usePDFSafetyGuard({\n        MAX_FILE_SIZE_MB: 100,\n        MAX_PAGE_COUNT: 500,\n    });\n\nCustom error handling:\n    const handlePDFSelected = async (file) => {\n        const result = await safetyGuard.check(file);\n        // Add custom logic here\n    };\n\nDisable safety guard (not recommended):\n    // Just call loadPDF() directly without check\n    await loadPDF(file);\n\n*/\n